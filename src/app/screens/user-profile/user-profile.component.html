<div class="container">
    <div class="column column-left">
        <p class="title">PROFILE</p>
        <div class="profile-info">
            <div class="info-group">
                <label for="name">Name</label>
                <p class="user-data">{{ name }}</p>
                <hr>
            </div>
            <div class="info-group">
                <label for="email">Email</label>
                <p class="user-data">{{ email }}</p>
                <hr>
            </div>
            <div class="info-group">
                <label for="birthday">Birthday</label>
                <p class="user-data">{{ birthday }}</p>
                <hr>
            </div>
        </div>
        
        <!-- Grupo de botones -->
        <div class="button-group">
            <button (click)="showChangePasswordDialog()" class="btn">Change Password</button>
            <button (click)="showConfirmDeleteDialog()" class="btn">Delete Account</button>
            <button (click)="showInfoPointsDialog()" class="btn">C&V's Points Program</button>
        </div>
    </div>
    
    <!-- Nueva estructura del contenedor derecho -->
      <div class="column-right">
          <div class="right-top-section">
              <div class="mug-icon-container">
                  <i class="fa-solid fa-mug-hot mug-icon mr-2"></i>
                  <p>{{currentMonthlyPoints}}</p>
              </div>
              <h1 class="rewards-title">C&V Rewards</h1>
        <div class="user-info">
          <h2>{{ name }}</h2>
          <p>Level: {{ levelName }}</p>
          
          <p *ngIf="isTopLevel && !achievedMonthlyPointsMessage">
            You are at the top level! {{ pointsNeededToMaintain }} points left to maintain this level.
          </p>
          <p *ngIf="!isTopLevel && nextLevelData">
            C&V's points needed to upgrade to {{ nextLevelData.name }}: {{ pointsToNextLevel }}.
          </p>
          <p *ngIf="achievedMonthlyPointsMessage">
            {{ achievedMonthlyPointsMessage }}
          </p>
          
          
          <p *ngIf="!nextLevelData && !isTopLevel">Loading next level data...</p>
        </div>
        <div class="card">
          <p-carousel 
              [value]="rewards" 
              [numVisible]="3" 
              [numScroll]="1" 
              [responsiveOptions]="responsiveOptions">
                  <ng-template let-reward pTemplate="item">
                      <div class="reward-box border-1 surface-border border-round m-2 p-3" (click)="showDiscountCode(reward)">
                          <div class="mb-3">
                              <div class="relative mx-auto">
                                  <img 
                                      src="{{ reward.imageUrl }}" 
                                      [alt]="reward.name" 
                                      class="w-full border-round" />
                              </div>
                          </div>
                          <div class="mb-3 font-medium text-center">
                              {{ reward.name }}
                          </div>
                      </div>
                  </ng-template>
          </p-carousel>
      </div>
      <p-dialog [(visible)]="displayDiscountDialog" [modal]="true" header="{{selectedReward?.name}}" [closable]="true" class="discount-dialog">
        <div class="discount-dialog-content">
            <p *ngIf="selectedReward?.description" class="discount-description">{{ selectedReward?.description }}</p>
            <p class="discount-code">Use code <strong>{{ selectedReward?.code }}</strong> for a discount!</p>
        </div>
    </p-dialog>
      </div>
      <div class="right-bottom-section">
        <h2 class="ranking-title">Employee Monthly Ranking</h2>
        <div class="table-container">
          <p-table
            #dt2
            [value]="ranking" 
            dataKey="name" 
            [loading]="loading"
            [scrollable]="true"
            scrollHeight="400px"
            class="user-table"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Points</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-user let-i="rowIndex">
              <tr>
                <!-- Rank column showing 1, 2, 3, etc. based on row index -->
                <td>{{ i + 1 }}</td>
      
                <!-- Name and Image column -->
                <td class="name-column">
                  <img 
                    [alt]="user.name" 
                    [src]="user.imageUrl" 
                    class="user-image" />
                  <span>{{ user.name }}</span>
                </td>
      
                <!-- Points column -->
                <td>{{ user.monthlyPoints }}</td> <!-- Use monthlyPoints from ranking data -->
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="3">No users found.</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
</div>

<p-dialog [(visible)]="displayConfirmDeleteDialog" [modal]="true" header="Delete Account" [closable]="true">
    <app-confirmation-pop-up
      [subtitle]="'Are you sure you want to proceed?'"
      (onClose)="closeConfirmDeleteDialog()"
      (onSend)="onDeleteAccount()">
    </app-confirmation-pop-up>
  </p-dialog>

  <p-dialog [(visible)]="displayChangePasswordDialog" [modal]="true" header="Change Password Account" [closable]="true">
    <app-confirmation-pop-up
      [subtitle]="'Are you sure you want to proceed?'"
      (onClose)="closeChangePasswordDialog()"
      (onSend)="changePassword()">
    </app-confirmation-pop-up>
  </p-dialog>
  
  
  <p-dialog [(visible)]="displayErrorDialog" [modal]="true" header="Error" [closable]="true">
    <app-notice
      [subtitle]="'Something went wrong, please try again'"
      (onClose)="closeErrorDialog()">
    </app-notice>
  </p-dialog>
  
  <p-toast></p-toast>

  <p-dialog  [(visible)]="displayInfoPointsDialog" [modal]="true" header="Information" [closable]="true">
    <app-info-points></app-info-points>
  </p-dialog>