<div class="popup-backdrop">
  <div class="popup-content" role="dialog" aria-modal="true" aria-label="Check-out">
    <div class="popup-header">
      <div class="avatar">☕</div>
      <div class="title-wrap">
        <h2>Hi, {{ userName || 'Employee' }}</h2>
        <div class="sub">Check-out at <strong>{{ currentTime }}</strong></div>
      </div>
    </div>

    <div *ngIf="loadingPreview" class="msg info">
      <span class="spin"></span> Checking your shift…
    </div>

    <ng-container *ngIf="!loadingPreview && preview">
      <div class="shift-box">
        <div class="row" *ngIf="preview.expected_start && preview.expected_end">
          <span class="label">Your shift</span>
          <span class="value">{{ preview.expected_start }}–{{ preview.expected_end }}</span>
        </div>
        <div class="row" *ngIf="preview.check_in_time">
          <span class="label">Check-in</span>
          <span class="value">{{ preview.check_in_time | date:'HH:mm' }}</span>
        </div>
        <div class="row">
          <span class="label">Worked</span>
          <span class="value">{{ mmToHhMm(preview.workedMin) }}</span>
        </div>
      </div>

      <div class="buttons">
        <button class="btn ghost" (click)="onClose()">Cancel</button>
        <button class="btn primary" [disabled]="loadingSubmit" (click)="onConfirm()">
          <span *ngIf="loadingSubmit" class="spin inline"></span>
          {{ loadingSubmit ? 'Saving…' : 'Confirm check-out' }}
        </button>
      </div>
    </ng-container>
  </div>
</div>
